<!DOCTYPE html>
<html>
<head lang="en">
    <meta name="viewport"v
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <title>抽奖</title>
    <script src="js/fontAuto.js"></script>
    <link rel="stylesheet" href="css/style.css"/>
    <script src="js/zepto.min.js"></script>
    <script src="js/zepto-touch.js"></script>
</head>
<body>
<div id="title"><i></i><span></span></div>
<div class="top"></div>
<form class="r-main" method="post">
    <span class="pan"></span>
    <input class="pointer" type="button"/>
</form>
<div class="r-bottom"></div>
<script>
    /*
     0：一等奖，
     48:谢谢参与,
     118:四等奖
    192:三等奖，
     265:二等奖,
     337:一等奖
     */
    var storageJson={

         '0':'一等奖',
         '48':'谢谢参与',
         '448':'四等奖',
         '192':'三等奖',
         '265':'二等奖',
         '337':'一等奖'
    }
    if(window.localStorage)
    {
        if(localStorage.resultDeg){//表示已经抽过奖了
            alert(localStorage.resultDeg)
            var resultMessage=storageJson[localStorage.resultDeg];
            alert("您已经抽过奖了！\n您的奖品是"+resultMessage);
        }
    }
    $(".pointer").tap(function(){
        if(window.localStorage)
        {
            if(localStorage.resultDeg){//表示已经抽过奖了
                var resultMessage=storageJson[localStorage.resultDeg];
                alert("您已经抽过奖了！\n您的奖品是"+resultMessage);
                return;
            }
        }
        $.ajax({
            type:"get",
            url:"json/prize.json",
            success:function(json) {
                if(json.message=='success'){
                    var deVal=360*2;
                    if(json.result==0){
                        var resultDeg=48;
                        deVal+=48;
                        var res='thanks';
                    }
                    else if(json.result==1)
                    {
                        var arr=[0,337]
                        var randomVal=Math.floor(Math.random()*2);
                        var resultDeg=arr[randomVal];
                        deVal+=arr[randomVal];
                        var res='first';
                    }
                    else if(json.result==2){
                        var resultDeg=265;
                        deVal+=265;
                        var res='second';
                    }
                    else if(json.result==3){
                        var resultDeg=192;
                        deVal+=192;
                        var res='third';
                    }
                    else if(json.result==4){
                        var resultDeg=118;
                        deVal+=118;
                        var res='forth';
                    }
                    var panMainNode=document.querySelector(".pan");
                    panMainNode.style.transform="rotate("+deVal+"deg)";
                    panMainNode.style.WebkitTransform="rotate("+deVal+"deg)";
                    panMainNode.style.MozTransform="rotate("+deVal+"deg)";
                    panMainNode.style.OTransform="rotate("+deVal+"deg)";
                    panMainNode.style.MsTransform="rotate("+deVal+"deg)";
                    var formNOde=document.querySelector(".r-main");
                    var htmlName=res+'.html';
                    formNOde.action=htmlName;
                    if(window.localStorage){
                        localStorage.resultDeg=resultDeg;
                    }
                }
                else{
                    alert('1系统忙,请稍后！')
                }
            },
            error:function(a,b,c){
                alert('2系统忙,请稍后！')
            }
        })
    })
</script>
</body>
</html>